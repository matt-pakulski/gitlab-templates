include:
  # include the component located in the current project from the current SHA
  - component: $CI_SERVER_FQDN/$CI_PROJECT_PATH/git-mirroring@$CI_COMMIT_SHA

.clone-repo:
  image: bitnami/git
  variables:
    GIT_STRATEGY: none
    SOURCE_REPO_URL: $REPO_URL
  before_script:
    - !reference [.git-mirroring:tests:snippets, print env variables]
    - !reference [.git-mirroring:snippets, create_configure_git_function]
    - !reference [.git-mirroring:snippets, configure_git:source]
    - git clone $REPO_URL

# Common test tasks
.git-mirroring:tests:snippets:
  configure git commit user:
    - git config user.name "$GITLAB_USER_NAME"
    - git config user.email "$GITLAB_USER_EMAIL"

  create a commit:
    - touch test.txt
    - echo "Adding content for a commit $(date)" >> test.txt
    - git add test.txt
    - git commit -m "Adding commit for a test"

  # If the DEBUG environment variable is set, print the sorted environment variables
  print env variables:
    - "[[ -n $DEBUG ]] && env | sort -t '=' -k 1,1"

